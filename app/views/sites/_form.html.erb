<style>
  .fa-cog{
    animation: rotate 2s linear;
  }
  .folder .fa-arrow-right{
    position:absolute;
    right:.5em;
  }
  .folder{
    position: relative;
    border-bottom:1px solid #ccc;
    padding:.5em;
  }
  .folder:hover{
    background:rgba(0%,48.3%,91.1%, .1);
  }
  .folder.active{
    background:rgba(0%,48.3%,91.1%, .2);
  }
  .folder a{
    text-decoration:none;
  }
  @keyframes {
    0% {
      transform: rotate(0)
    }
    100% {
      transform: rotate(360)
    }
  }
</style>
<% if @site.errors.any? %>
  <ul>
  <% @site.errors.full_messages.each do |e| %>
    <li> <%= e %></li>
  <% end %>
  </ul>
<% end %>
<%= form_for @site do |f| %>
  <div id='db-chooser'></div>
  <script>
    var token = '<%= @site.creator.access_token %>'
    var container = document.getElementById('db-chooser')
    getFolders()
    function getFolders(path){
      var path = path || ''
      container.innerHTML = '<i class="fa fa-cog"></i>'
      $.getJSON('/folders?access_token=' + token + '&path=' + path, function(response){
	$(".fa-cog").remove()
	if(path){
	  var back = $("<div class='folder back' data-path='"+path+"'><a href='#' class='back' data-path='"+path+"'><i class='fa fa-arrow-left'></i> Back</a></div>")
	  container.appendChild(back[0])
	}
	if(!response.length){
	  container.innerHTML += 'No folders here'
	}
	response.forEach(function(folder){
	  container.appendChild(view(folder))
	})
      })
    }
    container.addEventListener("click", function(event){
      if(event.target.classList.contains("back")){
        event.preventDefault()
	var path = event.target.getAttribute("data-path")
	path = path.split("/")
	path.pop()
	path = path.join("/")
	getFolders(path)
      }
    })
    function view(folder){
      var div = $('<div class="folder"><a href="#"><span class="fa fa-folder"></span> ' + folder.name + "<span class='fa fa-arrow-right'></span></a></div>")
      div.on('click', function(event){
	event.preventDefault()
	if(event.target.classList.contains('fa-arrow-right')){
	  getFolders(folder.path_lower)
	}else{
	  $(".active").removeClass("active")
          $(event.target).closest(".folder").addClass('active')
        }
      })
      return div[0]
    }
  </script>
  <%= f.label :name %>
  <div class='suffix-domain'>
    <%= f.text_field :name %>
  </div>
  <br>
  <%= f.label :domain %>
  <%= f.text_field :domain %> (optional) <small data-toggle=".instructions">What is this?</small><br><br>
  <% if @site.creator && @site.creator.is_pro %>
    <%= f.label :document_root %>
    <%= f.text_field :document_root, placeholder: '_site/' %> (optional) <br><br>
    <%= f.label :render_markdown %>
    <%= f.check_box :render_markdown %> (optional) <br><br>
  <% end %>
  <%= f.submit 'Save', :class => 'btn-create' %>
  <div class='instructions'>
  <p>Using your own custom domain? To enable this feature:</p>
  <ol>
    <li>Log in to your DNS host.</li>
    <li>Create a new CNAME record that points to updog.co</li>
    <li>Save your changes and wait for the DNS to propagate.</li>
    <li>Need help? email <a href='mailto:jesse@updog.co'>jesse@updog.co</a></li>
  </ol>
  <p>Hereâ€™s what that process looks like on Digital Ocean:</p>
  <img src='https://dl.dropboxusercontent.com/s/4ksisxk7khatbi7/do.gif?dl=0'>
  </div>
  <br>
  <br>
<% end %>
